<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/annyang/2.5.0/annyang.min.js"></script>
    <script>
      (function () {
        function recognized(text) {
          var rec = document.getElementById('conversation');
          rec.innerHTML += '<div class="recognized"><div>' + text + '</div></div>';
        }

        function sendAction(action, data) {
          var formData = new FormData();
          formData.append('action', action);
          if (data) {
            formData.append('data', data);
          }

          var request = new XMLHttpRequest();
          request.open('POST', 'http://192.168.1.91/spotcommander/main.php');
          request.send(formData);
        }

        if (annyang) {
          var commands = {
            'stop': function () {
              recognized('Stop');
              sendAction('play_pause');
            },
            'play': function () {
              recognized('Play');
              sendAction('play_pause');
            },
            'next': function () {
              recognized('Next song');
              sendAction('next');
            },
            'previous': function () {
              recognized('Previous song');
              sendAction('previous');
            },
            'loud': function () {
              recognized('Volume up');
              sendAction('adjust_spotify_volume', 'up');
            },
            'down': function () {
              recognized('Volume down');
              sendAction('adjust_spotify_volume', 'down');
            },
            ':nomatch': function (message) {
              recognized(`${message} not recognized`);
            }
          };

          annyang.addCommands(commands);
          annyang.start();
        }

        annyang.addCallback('error', function () {
          console.log('error');
        });
      })();
    </script>
  </head>
  <body>
    <div id="conversation"></div>
  </body>
</html>
